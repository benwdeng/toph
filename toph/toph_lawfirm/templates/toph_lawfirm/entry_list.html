<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
        integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous">
        

    <title>The Online Planning Hub - Law Firm Portal</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            font-size: 11px;
            /* Slightly smaller font */
            background-color: #fafafa;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            /* Collapse borders */
        }

        th,
        td {
            text-align: left;
            padding: 5px;
            /* Add more padding */
            border-bottom: 1px solid #ddd;
            font-size: 11px;
            /* Add bottom border */
        }

        th {
            background-color: #004ea0;
            /* Header background color */
            color: white;
            /* Header font color */
        }


        a {
            color: #114174;
            /* Links color */
            text-decoration: none;
            /* Remove underline */
        }

        a:hover {
            text-decoration: underline;
            /* Underline on hover */
        }

        .section-box {
            background-color: #ffffff;
            border: 1px solid #ddd;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
            margin-top: 0px;
            /* Adjust as needed for spacing between sections */
            border-radius: 8px;
        }

        .section-box button {
            background-color: #4CAF50;
            color: white;
            padding: 7px 10px;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 12px;
            /* Adjust button font size */
            font-weight: normal;
            /* Make button text bold */
        }

        .section-box button:hover {
            background-color: #45a049;
        }


        /* Banner style */
        .banner {
            display: flex;
            /* Use flexbox layout */
            justify-content: space-between;
            /* Space between items */
            align-items: center;
            /* Align items vertically */
            background-color: #004ea0;
            /* Blue color */
            color: white;
            /* White text color */
            padding: 0px 20px;
            /* Some padding */
            position: fixed;
            /* Make the banner fixed at the top */
            width: 100%;
            /* Full width */
            top: 0;
            left: 0;
            z-index: 2;
            /* Ensure banner is above other content */
        }

        .logout-button {
            background: none;
            border: none;
            cursor: pointer;
            color: white;
            font-size: 16px;
        }

        .logout-container {
            margin-right: 40px;
            /* Adjust this value as needed */
        }




        /* Container for sidebar and main content */
        .container {
            display: flex;
            margin-top: 10px;
            /* Adjust based on the height of your banner */
            width: 100%;
        }

        /* The sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: calc(100vh - 20px);
            width: 12%;
            position: fixed;
            top: 20px;
            left: 0;
            background-color: #1c3850;
            overflow-x: hidden;
            padding-top: 20px;
            z-index: 1;
        }

        .sidebar a {
            padding: 10px 10px;
            text-decoration: none;
            font-size: 14px;
            color: white;
            display: block;
        }

        .sidebar a:hover {
            background-color: #152b3e;
        }

        .sidebar a.active {
            background-color: #152b3e;
            color: #ffffff;
        }

        .sidebar-content {
            /* Styles for the sidebar content go here */
        }

        .sidebar-dropdown {
            padding: 0 10px 10px;
            /* Slightly reduced bottom padding for visual compactness */
            margin: 20px 0;
            /* Increased margin for visual separation from other elements */
        }

        .sidebar select {
            width: 100%;
            padding: 10px;
            /* Increased padding for better text visibility and aesthetics */
            background-color: #152b3e;
            /* Darker shade to match the sidebar theme */
            color: white;
            border: 1px solid #5D6D7E;
            /* Slightly lighter border for subtle contrast */
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            box-sizing: border-box;
            /* Ensures padding doesn't affect the overall width */
            appearance: none;
            /* Removes default system appearance to apply custom styles */
            /* Custom arrow using FontAwesome. Adjust as necessary if FontAwesome is not used */
            background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path fill="%23ffffff" d="M7 10l5 5 5-5z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 10px center;
            /* Position for the custom arrow */
            background-size: 12px;
            /* Size of the custom arrow */
        }

        .sidebar select:focus {
            outline: none;
            border-color: #5D6D7E;
            /* Highlight color for focused state */
        }

        .sidebar select option {
            background-color: #152b3e;
            /* Dark background for options */
            color: white;
            /* Ensure text is readable */
        }

        /* Main content */
        .main-content {
            margin-left: 12%;
            /* Adjusted for sidebar */
            padding: 20px;
            padding-top: 00px;
            /* Adjust as needed */
            flex: 1;
            /* Allows the main content to grow */
            max-width: 100%;
            /* Limit width to half of the screen */
        }


        .entry-counts-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 0px;
            gap: 0px;
            /* Adds space between the boxes */
        }

        .entry-count {
            flex: 1;
            min-width: 120px;
            /* Increased width for better readability */
            background-color: #f2f7fd;
            /* Light background */
            padding: 0px;
            /* More padding for spaciousness */
            margin: 10px;
            border-radius: 10px;
            /* Rounded corners */
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
        }

        .entry-count i {
            color: #114174;
            /* Icon color */
            font-size: 16px;
            /* Icon size */
            margin-top: 15px;
            margin-bottom: 0px;
            /* Space below the icon */
        }

        .entry-count p {
            font-size: 12px;
            /* Larger font size */
            color: #114174;
            /* Text color */
            font-weight: normal;
            /* Bold text */
        }


        /* The Modal (background) */
        .modal {
            display: none;
            /* Hidden by default */
            position: fixed;
            /* Stay in place */
            z-index: 100;
            /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            /* Full width */
            height: 100%;
            /* Full height */
            overflow: auto;
            /* Enable scroll if needed */
            background-color: rgb(0, 0, 0);
            /* Fallback color */
            background-color: rgba(0, 0, 0, 0.4);
            /* Black w/ opacity */
        }

        /* Modal Content */
        .modal-content {
            background-color: #fefefe;
            margin: 4% auto;
            /* Adjusted for better alignment */
            padding: 40px;
            /* Increased padding for a spacious look */
            border: 1px solid #888;
            width: 50%;
            /* Adjust the width as needed */
            /* Max width to prevent it from looking too wide on large screens */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            /* Subtle shadow for depth */
            border-radius: 8px;
            /* Rounded corners */
        }

        .modal-content form input[type="text"],
        .modal-content form select,
        .modal-content form textarea,
        .modal-content form input[type="date"] {
            width: calc(100% - 24px);
            /* Full width minus padding */
            padding: 12px;
            /* Comfortable padding */
            margin: 8px 0;
            /* Margin for spacing between fields */
            display: inline-block;
            border: 1px solid #ccc;
            border-radius: 4px;
            /* Rounded corners for the inputs */
            box-sizing: border-box;
            /* Include padding and border in the element's total width and height */
        }

        .modal-content form button[type="submit"] {
            background-color: #4CAF50;
            /* A pleasant green */
            color: white;
            padding: 14px 20px;
            margin: 8px 0;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            /* Rounded corners for the button */
            width: 100%;
            /* Full width */
        }

        .modal-content form button[type="submit"]:hover {
            background-color: #45a049;
            /* Darker shade on hover */
        }

        .modal-content form {
            margin-top: 20px;
            /* Add some space above the form */
        }

        .modal-content form label {
            margin-top: 10px;
            display: block;
            /* Ensure labels are on their own line */
            font-weight: normal;
            /* Make the labels slightly bolder */
        }

        .modal-content h2 {
            color: #1f446c;
            margin-top: 0;
            margin-bottom: 16px;
            /* Add more space below headings */
            font-size: 20px;
            /* Larger font size for headings */
            font-weight: normal;
            /* Make headings bold */
        }


        /* The Close Button */
        .close {
            color: #aaaaaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

        .entry-details {
            display: none;
            /* New */
            flex-direction: column;
            /* New */
            justify-content: flex-start;
            /* Adjusted for readability */
            background-color: #ffffff;
            border: 1px solid #ddd;
            box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin: 20px;
            margin-left: 0px;
            margin-top: 0px;
            font-size: 14px;
            color: #333;
            border-radius: 8px;
            overflow: hidden;
            /* Ensures the content is contained within the borders */
            height: 100%;
            /* Ensures it takes full height */
            min-width: 40%;
        }

        .entry-details-buttons {
            /* New class for the buttons container */
            margin-top: auto;
            /* Pushes the container to the bottom */
            display: flex;
            /* Allows inline display of buttons */
            justify-content: left;
            /* Spaces buttons evenly */
        }

        .entry-details-buttons button {
            margin-right: 10px;
            /* Adds space to the right of each button */
        }

        .entry-details-buttons button:last-child {
            margin-right: 0;
            /* Ensures the last button doesn't have extra space to its right */
        }

        .entry-details h3 {
            color: #1f446c;
            margin-top: 0;
            margin-bottom: 16px;
            /* Add more space below headings */
            font-size: 20px;
            /* Larger font size for headings */
            font-weight: normal;
            /* Make headings bold */
        }

        .entry-details p {
            margin: 10px 0 20px;
            /* Increase bottom margin for more space between paragraphs */
            line-height: 0;
            /* Improve readability */
            font-size: 11px;
            /* Slightly larger font size for paragraph text */
        }

        .entry-details a {
            color: #007bff;
            text-decoration: none;
            /* Optional: Remove underline from links */
            font-weight: normal;
            /* Make links bold or slightly heavier */
        }

        .entry-details a:hover {
            text-decoration: underline;
            /* Add underline on hover for links */
        }

        .entry-details button {
            background-color: #4CAF50;
            color: white;
            padding: 7px 10px;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 12px;
            /* Adjust button font size */
            font-weight: normal;
            /* Make button text bold */
        }

        .entry-details button:hover {
            background-color: #45a049;
        }

        .entry-details-buttons .delete-button {
            background-color: #d9534f;
            /* Red */
            color: white;
        }

        .entry-details-buttons .delete-button:hover {
            background-color: #c9302c;
            /* Darker red */
        }

        .entry-details hr {
            border: 0;
            height: 1px;
            /*background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));*/
            background-color: #1f446c;
            margin-top: 20px;
            margin-bottom: 20px;
        }



        .scrollable-table-container {
            overflow-x: auto;
            /* Enable horizontal scrolling */
            margin: 20px 0;
            /* Optional: Adds some space around the container */
        }

        #draftAgreementForm {
            background-color: #f0f0f0;
            padding: 20px;
            margin-top: 20px;
            border-radius: 5px;
        }

        table.dataTable.stripe tbody tr.odd,
        table.dataTable.display tbody tr.odd {
            background-color: #ffffff;
            /* Your color for odd rows */
        }

        table.dataTable.stripe tbody tr.even,
        table.dataTable.display tbody tr.even {
            background-color: #ffffff;
            /* Your color for even rows */
        }

        #entriesTable td {
            text-align: center; /* Center-align text horizontally */
            vertical-align: middle; /* Center-align text vertically */
        }

        #entriesTable th {
            text-align: center; /* Ensure header text is also centered */
        }

        #entriesTable tr.odd {
            background-color: #ffffff !important;
        }

        #entriesTable tr.even {
            background-color: #ffffff !important;
        }

        /* DataTables Custom Styling */
        .dataTables_wrapper {
            margin-top: 0px;
            /* Add space above the DataTable */
            box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
            /* Add shadow for some depth */
            border-radius: 5px;
            /* Round corners */
            overflow: hidden;
            /* Ensure rounded corners are not bypassed */
            text-align: center;
        }

        .dataTables_length,
        .dataTables_filter,
        .dataTables_info,
        .dataTables_paginate {
            padding: 10px;
            /* Padding for DataTable controls */
            background-color: #ffffff;
            /* Light background for controls area */
        }

        table.dataTable thead {
            background-color: #f9f9f9;
            /* Slightly different header background for contrast */
        }

        table.dataTable thead th {
            border-bottom: 2px solid #ddd;
            /* Make header bottom border more prominent */
        }

        table.dataTable.no-footer {
            border-bottom: 1px solid #eee;
            /* Lighter border for the bottom of the table */
        }

        .dataTables_filter input {
            border-radius: 20px;
            /* Rounded corners for search input */
            border: 1px solid #ccc;
            /* Light border for the search input */
            padding: 5px 10px;
            /* Padding inside search input */
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button {
            padding: 5px 10px;
            /* Padding for pagination buttons */
            margin: 0 2px;
            /* Spacing between pagination buttons */
            border-radius: 3px;
            /* Rounded corners for pagination buttons */
            border: 1px solid transparent;
            /* Transparent border for pagination buttons */
            background-color: #ffffff;
            /* Background for pagination buttons */
            cursor: pointer;
            /* Cursor to pointer to indicate clickable */
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
            background-color: #ccc;
            /* Darker background on hover for pagination buttons */
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button.current,
        .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {
            color: #fff !important;
            /* White text for active pagination button */
            border: 1px solid #0275d8;
            /* Blue border for active pagination button */
            background-color: #0275d8;
            /* Blue background for active pagination button */
        }


        .sidebar a {
            padding: 10px 15px;
            text-decoration: none;
            font-size: 12px;
            /* Adjust this value as needed */
            color: white;
            display: block;
        }

        /* Title Styles */
        .title {
            font-size: 22px;
            /* Larger font size */
            font-weight: normal;
            /* Bold text */
            color: #114174;
            /* Adjust the color to fit your design */
            /*text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);*/
            /* Subtle shadow for depth */
            margin: 5px 0 5px;
            /* Adequate spacing around the titles */
            padding-bottom: 5px;
            /* Bottom padding */
            /*border-bottom: 2px solid #1f446c;*/
            /* A solid line under the title for emphasis */
            display: inline-block;
            /* Required for the border-bottom to work properly */
        }


        /* Flex container for each row */
        .form-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            /* Ensure it takes full width */
            margin-bottom: 10px;
            /* Spacing between rows */
        }

        /* Flex item for input fields to take available space */
        .form-field {
            flex-grow: 1;
            margin-right: 10px;
            /* Spacing between fields */
        }

        /* Last item in the row should not have a margin on the right */
        .form-field:last-child {
            margin-right: 0;
        }

        /* Specifically target the narrow inputs */
        .narrow-input {
            width: 80px;
            /* Adjust this value as needed */
            margin-left: auto;
            /* This will push the input to the right */
            flex-grow: 0;
            /* Prevent it from growing */
        }


        /* Adjustments for labels and inputs for better alignment and spacing */
        .form-field label {
            margin-bottom: 5px;
            /* Space between label and input */
            /* Slightly larger font size for better readability */
        }

        .form-field input[type="text"] {
            padding: 8px;
            /* Padding inside input fields */
            border-radius: 4px;
            /* Rounded corners for inputs */
            border: 1px solid #ccc;
            /* Border for inputs */
        }


        .approvals-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .approvals-table thead th {
            background-color: #004ea0;
            /* Adjust to fit your color scheme */
            color: white;
            padding: 7px;
            text-align: center;
            font-size: 11px;
        }

        .approvals-table tbody td {
            padding: 5px;
            border-bottom: 1px solid #ddd;
            text-align: center;
            font-size: 11px;
        }

        .approvals-table tbody tr:nth-child(even) {
            background-color: #f8f8f8;
        }
        
        .approvals-table a {
            color: #007bff;
            text-decoration: none;
        }

        .approvals-table a:hover {
            text-decoration: underline;
        }

        .context-menu {
            display: none; /* Hidden by default */
            position: absolute; /* Position it relative to its trigger */
            z-index: 1000; /* Ensure it's on top */
            width: 80px; /* Set a fixed width */
            background-color: #ffffff; /* Light background color */
            border: 1px solid #ddd; /* Light border */
            box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
            border-radius: 5px; /* Rounded corners */
            overflow: hidden; /* Ensures the content fits within the borders */
            cursor: default; /* Default cursor to indicate non-clickable background */
        }

        .context-menu ul {
            list-style: none;
            margin: 0;
            padding: 0;
            background: none;
        }

        .context-menu ul li {
            padding: 5px 5px; /* More padding for larger touch targets */
            cursor: pointer; /* Pointer cursor to indicate clickable items */
            font-size: 11px; /* Slightly larger font size */
            color: #333; /* Dark text color for better readability */
            border-bottom: 1px solid #f1f1f1; /* Light border for separating items */
        }

        .context-menu ul li:last-child {
            border-bottom: none; /* Remove bottom border for the last item */
        }

        .context-menu ul li:hover {
            background-color: #f7f7f7; /* Lighter background on hover */
            color: #0056b3; /* Change text color on hover for better visibility */
        }

        .context-menu-trigger {
            display: inline-block; /* Or flex, as needed */
            padding-left: 10px; /* Adjust based on your design */
            padding-right: 10px; /* Adjust based on your design */
            cursor: pointer;
        }


        .email-form {
            display: flex;
            flex-direction: column;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
        }

        .form-group input[type="email"],
        .form-group input[type="text"],
        .form-group textarea,
        .form-group input[type="file"] {
            width: 100%;
            padding: 10px;
            margin: 5px 0 15px 0;
            display: inline-block;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .highlighted-row {
            background-color: #ffc107 !important; /* Use your preferred highlight color */
        }


        .council-title-section {
            text-align: center;
            font-size: 24px; /* Adjust font size as needed */
            color: #114174; /* Adjust color to match your design */
            padding: 10px 20px; /* Add some padding, including left and right */
            margin-top: 50px; /* Top margin */
            margin-bottom: 20px; /* Top margin */
            margin-left: 20px;
            font-weight: bold; /* Make the text bold */
            background-color: #ffffff; /* Background color of the title box */
            border: 1px solid #ddd; /* Optional: Add a border */
            box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1); /* Optional: Add some shadow for depth */
            position: relative; /* Use relative positioning */
            left: 12%; /* Start from 12% of the left side */
            width: calc(100% - 12% - 40px); /* Adjust width to take up the remaining space minus sidebar width and padding */
            box-sizing: border-box; /* Ensure padding and border are included in the total width */
            border-radius: 8px;
        }

        .entry-method-selection {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .entry-method {
            display: inline-block;
            padding: 10px 20px;
            margin: 0 10px;
            cursor: pointer;
            border-radius: 20px;
            transition: background-color 0.3s, color 0.3s;
            user-select: none; /* prevent text selection */
        }

        input[type="radio"] {
            display: none; /* hide the radio button */
        }

        input[type="radio"]:checked + label {
            background-color: #007bff;
            color: white;
        }

        /* Add some hover effects for labels */
        .entry-method:hover {
            background-color: #0056b3;
            color: white;
        }




    </style>

</head>

<body>

    <div class="banner">
        <div>
            <h1 style="font-size: 16px;">The Online Planning Hub - Law Firm Portal</h1>
        </div>
        <!-- Logout Button -->
        {% if request.user.is_authenticated %}
        <div class="logout-container">
            <form action="{% url 'toph_lawfirm_logout' %}" method="post" style="margin: 0;">
                {% csrf_token %}
                <button type="submit" style="font-size: 14px;" class="logout-button">Logout</button>
            </form>
        </div>
        {% endif %}
    </div>

    <div class="council-title-section">
        Cardinia Shire Council
    </div>




    <div class="container">
        <div class="sidebar">
            <div class="sidebar-content">
                <a href="#" id="overviewLink" class="active">Home</a>
                <a href="#" id="councilLink">Council Information</a>

            </div>
            <div class="sidebar-dropdown">
                <a style="padding-left: 5px;">Law Firm / Council View:</a>
                <select style="margin-bottom: 5px;" id="groupSelect" single>
                    {% for group in user_groups %}
                    <option value="{{ group }}">{{ group }}</option>
                    {% endfor %}
                </select>
                <select id="groupSelect" single>
                    <option value="">Cardinia Shire Council</option>
                </select>
            </div>

        </div>

        <div class="main-content">
            <div id="overviewContent">
                <div class="section-box">
                    <h2 class="title">Overview</h2>
                    <!-- Box displaying the number of entries -->
                    <div class="entry-counts-container">
                        <div class="entry-count total-matters">
                            <i class="fas fa-briefcase"></i>
                            <p>Total matters: <strong>{{ entries|length }}</strong></p>
                        </div>
                        <div class="entry-count active-matters">
                            <i class="fas fa-sync"></i>
                            <p>Active matters: <strong>{{ entries_active|length }}</strong></p>
                        </div>
                        <div class="entry-count active-matters">
                            <i class="fas fa-check-circle"></i>
                            <p>Closed matters: <strong>{{ entries_closed|length }}</strong></p>
                        </div>
                    </div>


                </div>
                <div class="section-box">
                    <h2 class="title">Matters</h2>

                    <div class="scrollable-table-container">
                        <table id="entriesTable">
                            <thead>
                                <tr>
                                    <th>Matter ID</th>
                                    <th>Date Engaged</th>
                                    <th>Subject Land</th>
                                    <th>Status</th>
                                    <th>View</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for entry in entries %}
                                <tr>
                                    <td>{{ entry.pk }}</td>
                                    <td>{{ entry.created_date|date:"d M Y" }}</td>
                                    <td>{{ entry.subject_land_address }}</td>
                                    <td>{{ entry.get_status_display }}</td> <!-- Use get_FOO_display method here -->
                                    <td><a href="#" onclick="viewEntry('{{ entry.pk }}'); return false;"><i class="fas fa-eye"></i></a></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <!-- Trigger/Open The Modal -->
                    <button id="addEntryBtn" onclick="openAddEntryModal('{{user_groups.0}}')">Create new matter</button>
                </div>
                <div class="section-box">
                    <h2 class="title">Council Information</h2>
                    <table>
                        <tr><td><strong>Email:</strong></td><td>{{council_info.council_email}}</td></tr>
                        <tr><td><strong>Phone:</strong></td><td>{{council_info.council_phone}}</td></tr>
                        <tr><td><strong>Address:</strong></td><td>{{council_info.council_address}}</td></tr>
                    </table>
                    <button id="editCouncilInformationButton" onclick="openEditCouncilInfoModal('{{council_info.pk}}')" style="margin-bottom: 20px;">Edit</button>
                    <br>
                    <hr>
                    <h2 class="title" style="margin-top: 20px;">Council Documents</h2>
                    <table id="councilDocumentsTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Document</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for document in documents %}
                            <tr>
                                <td>Verification of Identity</td>
                                <td><a href={{ document.url }} download={{ document.name }}>Download</a></td>
                                <td>Delete</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <button id="addCouncilDocumentButton">Add document</button>
                    <p style="color: red;">This is under development</p>
                </div>
            </div>

        </div>

        <div class="entry-details"></div>
    </div>
    <!-- Add Entry Modal -->
    <div id="addEntryModal" class="modal">
        <!-- Modal content -->
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Add New Matter</h2>
            <form id="addEntryForm" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="hidden" id="hiddenLawFirm" name="law_firm" value="">
                <input type="hidden" id="hiddenCouncil" name="council" value="Cardinia Shire Council">
                <input type="hidden" id="hiddenCouncilEmail" name="council_email" value="{{council_info.council_email}}">
                <input type="hidden" id="hiddenCouncilPhone" name="council_phone" value="{{council_info.council_phone}}">
                <input type="hidden" id="hiddenCouncilAddress" name="council_address" value="{{council_info.council_address}}">
                {{ form.as_p }}
                <button type="submit" id="entry-submit-button">Submit</button>
            </form>
        </div>
    </div>

    <!-- Edit Entry Modal -->
    <div id="editEntryModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Edit Matter</h2>
            <form id="editEntryForm" method="post" enctype="multipart/form-data">
                <!-- Form fields will be populated dynamically -->
            </form>
        </div>
    </div>

    <!-- Draft Form Modal -->
    <div id="draftFormModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Draft New or Upload Existing Section 173 Agreement</h2>
            <!-- Adjust the form as needed -->
            <form id="draft173Form" method="post" action="{% url 'toph_lawfirm_draft173' %}">
                <!-- Include CSRF Token -->
                {% csrf_token %}
                <input type="hidden" id="entryId" name="entryId">

                <div class="entry-method-selection">
                    <input type="radio" id="manualEntry" name="entryMethod" value="manual" checked>
                    <label for="manualEntry" class="entry-method">Draft New Agreement</label>
                    <input type="radio" id="fileUpload" name="entryMethod" value="upload">
                    <label for="fileUpload" class="entry-method">Upload Existing Agreement</label>
                </div>
                
                <hr>
                <br>
                <br>

                <div id="fileUploadFields" style="display: none;" class="form-group">
                    <h2>Upload Existing Section 173 Agreement</h2>
                    <label for="UploadDocument">Upload Document:</label>
                    <input type="file" id="UploadDocument" name="UploadDocument"><br>
                </div>

                <div id="manualEntryFields" style="display: block;">

                    <h2>Draft New Section 173 Agreement</h2>

                    <label for="SubjectLand">Subject land:</label>
                    <input type="text" id="SubjectLand" name="SubjectLand"><br><br>

                    <h2>Council and Owner Details</h2>
                    <label for="draftOwner1">Council:</label>
                    <select id="draftOwner1" name="draftOwner1">
                        <!-- Options will be added dynamically -->
                    </select>
                    <label for="numberOfOwners">Number of owners:</label>
                    <select id="numberOfOwners">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                    </select>
                    <br><br>

                    <div class="owner-section" id="owner1Section">
                        <legend>Owner 1</legend>
                        
                        <div id="owner1NameAddress">
                            <div class="form-row">
                                <div class="form-field">
                                    <select id="draftOwner2" name="draftOwner2">
                                        <!-- Options will be added dynamically -->
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="owner-section" id="owner2Section" style="display: none;">
                        <legend>Owner 2</legend>
                        
                        <div id="owner2NameAddress">
                            <div class="form-row">
                                <div class="form-field">
                                    <select id="draftOwner3" name="draftOwner3">
                                        <!-- Options will be added dynamically -->
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="owner-section" id="owner3Section" style="display: none;">
                        <legend>Owner 3</legend>
                                            
                        <div id="owner3NameAddress">
                            <div class="form-row">
                                <div class="form-field">
                                    <select id="draftOwner4" name="draftOwner4">
                                        <!-- Options will be added dynamically -->
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="owner-section" id="owner4Section" style="display: none;">
                        <legend>Owner 4</legend>
                        
                        <div id="owner4NameAddress">
                            <div class="form-row">
                                <div class="form-field">
                                    <select id="draftOwner5" name="draftOwner5">
                                        <!-- Options will be added dynamically -->
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="owner-section" id="owner5Section" style="display: none;">
                        <legend>Owner 5</legend>
                        
                        <div>Choose Input Type:</div>
                        <label><input type="radio" name="owner5InputType" value="nameAddress" checked>Name & Address</label>
                        <label><input type="radio" name="owner5InputType" value="acn">ACN</label>
                        
                        <div id="owner5NameAddress">
                            <div class="form-row">
                                <div class="form-field">
                                    <label for="Owner5Name">Name:</label>
                                    <input type="text" id="Owner5Name" name="Owner5Name">
                                </div>
                                <div class="form-field">
                                    <label for="Owner5Address">Address:</label>
                                    <input type="text" id="Owner5Address" name="Owner5Address">
                                </div>
                            </div>
                        </div>
                        
                        <div id="owner5ACN" style="display: none;">
                            <div class="form-row">
                                <div class="form-field">
                                    <label for="Owner5ACN">ACN Name:</label>
                                    <input type="text" id="Owner5ACN" name="Owner5ACN">
                                </div>
                                <div class="form-field">
                                    <label for="Owner5NumberDirectors">Number of Directors:</label>
                                    <select id="Owner5NumberDirectors" name="Owner5NumberDirectors">
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>



                    <h2>Certificate of Title</h2>
                    <label for="CoTVolumeNumber">CoT Volume Number:</label>
                    <input type="text" id="CoTVolumeNumber" name="CoTVolumeNumber"><br><br>
                    <label for="CoTFolioNumber">CoT Folio Number:</label>
                    <input type="text" id="CoTFolioNumber" name="CoTFolioNumber"><br><br>
                    <h2>Development Permit</h2>
                    <label for="DevelopmentPermitNumber">Development Permit Number:</label>
                    <input type="text" id="DevelopmentPermitNumber" name="DevelopmentPermitNumber"><br><br>
                    <label for="DevelopmentPermitIssueDate">Development Permit Issue Date:</label>
                    <input type="date" id="DevelopmentPermitIssueDate" name="DevelopmentPermitIssueDate"><br><br>
                    <label for="DevelopmentPermitCondition">Development Permit Condition:</label>
                    <input type="text" id="DevelopmentPermitCondition" name="DevelopmentPermitCondition"><br><br>
                    <h2>Subdivision Permit</h2>
                    <label for="SubdivisionPermitNumber">Subdivision Permit Number:</label>
                    <input type="text" id="SubdivisionPermitNumber" name="SubdivisionPermitNumber"><br><br>
                    <label for="SubdivisionPermitIssueDate">Subdivision Permit Issue Date:</label>
                    <input type="date" id="SubdivisionPermitIssueDate" name="SubdivisionPermitIssueDate"><br><br>
                    <label for="SubdivisionPermitCondition">Subdivision Permit Condition:</label>
                    <input type="text" id="SubdivisionPermitCondition" name="SubdivisionPermitCondition"><br><br>
                    <h2>Other</h2>
                    <label for="draftOwner6">Mortgage Institution:</label>
                    <select id="draftOwner6" name="draftOwner6">
                        <!-- Options will be added dynamically -->
                    </select>
                    <label for="draftOwner7">Caveator Name:</label>
                    <select id="draftOwner7" name="draftOwner7">
                        <!-- Options will be added dynamically -->
                    </select>

                </div>

                <button type="submit" id="draft-submit-button">Submit</button>
            
            </form>

        </div>
    </div>

    <div id="approvalModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Add Reviewer</h2>
            <form style="margin-bottom: 20px;" id="approvalForm">
                <input type="hidden" id="approval_approval_id" name="approval_id">
                <input type="hidden" id="approval_entry_id" name="entry_id">
                <input type="hidden" id="approval_cc_email" name="cc_email">
    
                <!-- Reviewers Dropdown -->
                <div class="form-group">
                    <label for="reviewersDropdown">Reviewer (Hold Ctrl to select multiple):</label>
                    <select id="reviewersDropdown" name="party_id" style="width: 100%;" multiple>
                        <!-- Options will be populated dynamically here -->
                    </select>

                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <div class="form-field">
                        <label for="reminder_delay">Reminder Delay (days):</label>
                        <select id="reminder_delay" name="reminder_delay">
                            <option value=-1>-</option>
                            <option value=1>1</option>
                            <option value=2>2</option>
                            <option value=3>3</option>
                            <option value=4>4</option>
                            <option value=5>5</option>
                            <option value=6>6</option>
                            <option value=7>7</option>
                            <option value=8>8</option>
                            <option value=9>9</option>
                            <option value=10>10</option>
                        </select>
                    </div>
                    <div class="form-field">
                        <label for="reminder_frequency">Reminder Frequency (days):</label>
                        <select id="reminder_frequency" name="reminder_frequency">
                            <option value=-1>-</option>
                            <option value=1>1</option>
                            <option value=2>2</option>
                            <option value=3>3</option>
                            <option value=4>4</option>
                            <option value=5>5</option>
                            <option value=6>6</option>
                            <option value=7>7</option>
                            <option value=8>8</option>
                            <option value=9>9</option>
                            <option value=10>10</option>
                        </select>
                    </div>
                </div>
                
                <button type="submit" id="approval-submit-button">Send</button>

            </form>
            <hr>
            <h2 style="margin-top: 20px;">Review Details</h2>
            <div id="reviewDetails">
                <!-- Review details will be populated here -->
            </div>

        </div>
    </div>
    
    
    



    <!-- DocuSign Send Document Modal -->
    <div id="docuSignModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Send Document for Signing</h2>
            <form id="docuSignForm" enctype="multipart/form-data">
                <input type="hidden" id="docusignEntryId" name="docusignEntryId" value="">

                <!-- Owner's Name and Email on one row with Order -->
                <div class="form-row">
                    <div class="form-field">
                        <label for="OwnerName1">Council:</label>
                        <select id="OwnerName1" name="OwnerName1" required>
                            <!-- Options will be added dynamically -->
                        </select>
                    </div>
                    <div class="form-field narrow-input">
                        <label for="OwnerOrder1">Order:</label>
                        <input type="text" id="OwnerOrder1" name="OwnerOrder1" required class="narrow-input">
                    </div>
                </div>

                <!-- Owner's Name and Email on one row with Order -->
                <div class="form-row">
                    <div class="form-field">
                        <label for="OwnerName2">Owner 1:</label>
                        <select id="OwnerName2" name="OwnerName2" required>
                            <!-- Options will be added dynamically -->
                        </select>
                    </div>
                    <div class="form-field narrow-input">
                        <label for="OwnerOrder2">Order:</label>
                        <input type="text" id="OwnerOrder2" name="OwnerOrder2" required class="narrow-input">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-field">
                        <label for="OwnerName3">Owner 2:</label>
                        <select id="OwnerName3" name="OwnerName3" >
                            <!-- Options will be added dynamically -->
                        </select>
                    </div>
                    <div class="form-field narrow-input">
                        <label for="OwnerOrder3">Order:</label>
                        <input type="text" id="OwnerOrder3" name="OwnerOrder3"  class="narrow-input">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-field">
                        <label for="OwnerName4">Owner 3:</label>
                        <select id="OwnerName4" name="OwnerName4" >
                            <!-- Options will be added dynamically -->
                        </select>
                    </div>
                    <div class="form-field narrow-input">
                        <label for="OwnerOrder4">Order:</label>
                        <input type="text" id="OwnerOrder4" name="OwnerOrder4"  class="narrow-input">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-field">
                        <label for="OwnerName5">Owner 4:</label>
                        <select id="OwnerName5" name="OwnerName5" >
                            <!-- Options will be added dynamically -->
                        </select>
                    </div>
                    <div class="form-field narrow-input">
                        <label for="OwnerOrder5">Order:</label>
                        <input type="text" id="OwnerOrder5" name="OwnerOrder5"  class="narrow-input">
                    </div>
                </div>

                <p style="color: red;"><strong>Please note signing process for mortgager/bank and caveator are under development</strong></p>


                <!-- Reminder Delay and Frequency on one row -->
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <div class="form-field">
                        <label for="reminderDelay">Reminder Delay (days):</label>
                        <select id="reminderDelay" name="reminderDelay">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                    <div class="form-field">
                        <label for="reminderFrequency">Reminder Frequency (days):</label>
                        <select id="reminderFrequency" name="reminderFrequency">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                </div>

                <!-- Document Upload -->
                    <div class="form-group">
                        <label for="documentUpload">Document for signing:</label>
                        <input type="file" id="documentUrl" name="documentUrl" required class="form-group">
                    </div>

                <button type="submit" id="docusign-submit-button">Send</button>
            </form>
        </div>
    </div>


    <!-- Lodge Email Modal -->
    <div id="lodgeEmailModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Lodge Document</h2>
            <form id="lodgeEmailForm" enctype="multipart/form-data" class="email-form">
                <input type="hidden" id="lodgeEntryId" name="entryId" value="">
                <div class="form-group">
                    <label for="targetEmail">To:</label>
                    <input type="email" id="targetEmail" name="targetEmail" required>
                </div>

                <div class="form-group">
                    <label for="ccEmail">CC:</label>
                    <input type="email" id="ccEmail" name="ccEmail" multiple>
                </div>

                <div class="form-group">
                    <label for="emailSubject">Subject:</label>
                    <input type="text" id="emailSubject" name="emailSubject" required>
                </div>

                <div class="form-group">
                    <label for="emailBody">Body:</label>
                    <textarea id="emailBody" name="emailBody" rows="4" required></textarea>
                </div>

                <div class="form-group">
                    <label for="emailAttachments">Attachments:</label>
                    <input type="file" id="emailAttachments" name="emailAttachments" multiple>
                    <div id="fileList" class="file-list"></div> <!-- Container for listing selected files -->
                </div>

                <button type="submit" id="lodge-submit-button" class="submit-button">Lodge</button>
            </form>
        </div>
    </div>



    <div id="addDocumentModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Add Document</h2>
            <form id="addDocumentForm" method="post" enctype="multipart/form-data" style="margin-bottom: 20px;">
                {% csrf_token %}
                <input type="hidden" id="hiddenEntryId" name="entryId" value="">
                {{ form_document.as_p }}
                <button type="submit" id="document-submit-button">Add</button>
            </form>
            <hr>
            <h2 style="margin-top: 20px;">Documents</h2>
            <div id="documentsList">
                <!-- Documents will be dynamically inserted here -->
            </div>
            
        </div>
    </div>

    <div id="PartyModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Add Party</h2>
            <form id="PartyForm" method="post" enctype="multipart/form-data" style="margin-bottom: 20px;">
                {% csrf_token %}
                <input type="hidden" id="partyEntryId" name="entryId" value="">
                {{ form_party.as_p }}
                <button type="submit" id="party-submit-button">Add</button>
            </form>
            <hr>
            <h2 style="margin-top: 20px;">Parties</h2>
            <div id="partiesList">
                <!-- Documents will be dynamically inserted here -->
            </div>
            
        </div>
    </div>

    <!-- Documents Lodged Modal -->
    <div id="documentsLodgedModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Documents Lodged</h2>
            <div id="documentLodgedDetails">
                <!-- Review details will be populated here -->
            </div>

        </div>
    </div>

    <!-- Edit Council Information Modal -->
    <div id="EditCouncilInfoModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Edit Council Information</h2>
            <form id="editCouncilInfoForm">
                <input type="hidden" id="lawfirmcouncilid" name="lawfirmcouncilid" value="{{ council_info.pk }}">

                <label for="email">Email:</label>
                <input type="text" id="email" name="email" value="{{ council_info.email }}"><br>
                
                <label for="phone">Phone:</label>
                <input type="text" id="phone" name="phone" value="{{ council_info.phone }}"><br>
                
                <label for="address">Address:</label>
                <input type="text" id="address" name="address" value="{{ council_info.address }}"><br>
                
                <button type="submit" id="edit-council-submit-button">Save Changes</button>
            </form>
        </div>
    </div>

    <!-- Outcome Modal -->
    <div id="outcomeModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Set Outcome</h2>
            <form id="outcomeForm">
                <input type="hidden" id="outcome_approval_id" name="approval_id">
                <label for="outcome">Outcome:</label>
                <select id="outcome" name="outcome">
                    <option value="">Please select an outcome</option>
                    <option value="Approved">Approved</option>
                    <option value="Rejected">Rejected</option>
                </select>
                
                <button type="submit" id="outcome-submit-button">Submit</button>
            </form>
        </div>
    </div>

    <div id="shareModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Share Owner Tracking Number</h2>
            <form id="shareForm">
                <input type="hidden" id="share_entry_id" name="entry_id">
    
                <!-- Reviewers Dropdown -->
                <div class="form-group">
                    <label for="partyDropdown">Please select parties to share with (Hold Ctrl to select multiple):</label>
                    <select id="partyDropdown" name="party_id" style="width: 100%;" multiple>
                        <!-- Options will be populated dynamically here -->
                    </select>

    
                <button type="submit" id="share-submit-button">Share</button>
            </form>

        </div>
    </div>
    




    <script src="https://api.addressfinder.io/assets/v3/widget.js" async defer></script>

    <script>
        let lastEntryId = null; // Track the last entry ID that was clicked



        function viewEntry(entryId) {
            const detailsContainer = document.querySelector('.entry-details');

            // For a different entry's "View" button click, or if it's the first time
            // an entry's "View" button is clicked, show the container and fetch details
            if (lastEntryId !== entryId) {
                lastEntryId = entryId; // Update lastEntryId to the current entry
                detailsContainer.style.display = 'block'; // Ensure it's displayed
                detailsContainer.style.visibility = 'visible'; // Ensure the container is visible

                // Construct the URL using the entry ID, ensuring to match your Django URL pattern
                const url = `/toph_lawfirm/entry-details/${entryId}/`;

                // Use the fetch API to make an AJAX call to the server
                fetch(url)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json(); // Parse the JSON in the response
                    })
                    .then(data => {
                        const subjectLandAddress = data.subject_land_address;

                        // Store this address for later use when opening the draft form
                        window.currentSubjectLandAddress = subjectLandAddress; 
                        const createDate = new Date(data.created_date);
                        const create_date_formatted = `${String(createDate.getDate()).padStart(2, '0')} ${['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'][createDate.getMonth()]} ${createDate.getFullYear()}`;

                        const lastDate = new Date(data.last_updated);
                        const last_date_formatted = `${String(lastDate.getDate()).padStart(2, '0')} ${['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'][lastDate.getMonth()]} ${lastDate.getFullYear()}`;

                        // Populate the details container with the fetched data
                        // Example of setting innerHTML, adjust according to your actual data structure
                        // <p><strong>Planning permit:</strong> <a href="${data.document_url}" target="_blank">Download</a></p>
                        detailsContainer.innerHTML = `
                            <h3>Details for Matter ID ${data.pk} </h3>
                            <table>
                                <tr><td>Subject Land:</td><td>${data.subject_land_address}</td><td></td></tr>
                                <tr><td>Law Firm:</td><td>${data.law_firm}</td><td></td></tr>
                                <tr><td>Council:</td><td>${data.council}</td><td></td></tr>
                                <tr><td>Date Engaged:</td><td>${create_date_formatted}</td><td></td></tr>
                                <tr><td>Last Updated:</td><td>${last_date_formatted}</td><td></td></tr>
                                <tr><td>Relevant Parties:</td><td><a href="#" onclick="openPartyModal('${data.pk}'); return false;">Add / View Parties</a></td><td></td></tr>
                                <tr><td>Documents / Permits:</td><td><a href="#" onclick="openAddDocumentModal('${data.pk}'); return false;">Add / View Documents</a></td><td></td></tr>
                                <tr><td>Status:</td><td>${data.status}</td><td></td></tr>
                                <tr><td>Owner Tracking Number:</td><td>${data.rdm_num}</td><td><a href="#" onclick="openShareModal('${data.pk}')">Share</a></td></tr>
                            </table>
                            <div class="entry-details-buttons">
                                <button id="editButton" onclick="fetchEditForm('${data.pk}'); return false;">Edit</button>
                                <button id="deleteButton" class="delete-button" onclick="confirmDelete('${data.pk}')">Delete</button>
                            </div>
                        `;

                        let approvalsHtml = `
                            <hr>
                            <h3>Draft and Review</h3>
                            <table class="approvals-table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Draft</th>
                                        <th>Date Drafted</th>
                                        <th>Reviews Completed</th>
                                        <th>Outcome</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                        `;
                        if (data.approvals.length > 0) {
                            data.approvals.sort((a, b) => a.pk - b.pk);
                            data.approvals.forEach((approval, index) => {
                                const approvalDate = new Date(approval.date);
                                const formattedApprovalDate = `${String(approvalDate.getDate()).padStart(2, '0')} ${['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'][approvalDate.getMonth()]} ${approvalDate.getFullYear()}`;

                                approvalsHtml += `
                                    <tr>
                                        <td>${index + 1}</td>
                                        <td>${approval.document ? `<a href="${approval.document}" target="_blank">Download</a>` : 'No document'}</td>
                                        <td>${formattedApprovalDate}</td>
                                        <td>${approval.reviewed_count} / ${approval.reviews_count}</td>
                                        <td>${approval.outcome ? approval.outcome : 'Pending'}</td>
                                        <td>
                                            <i class="fas fa-ellipsis-v context-menu-trigger" data-approval-id="${index}"></i>
                                            <div id="contextMenu${index}" class="context-menu" style="display: none;">
                                                <ul>
                                                    <li class="approve-approval-option" data-approval-id="${approval.pk}" data-entry-id="${data.pk}">Add / View Reviews</li>
                                                    <li class="outcome-approval-option" data-approval-id="${approval.pk}">Set Outcome</li>
                                                    <li class="delete-approval-option" data-approval-id="${approval.pk}">Delete</li>
                                                </ul>
                                            </div>
                                        </td>
                                    </tr>
                                `;
                            });
                        } else {
                            // Adjust colspan to match the number of columns in your table
                            approvalsHtml += `
                                <tr>
                                    <td colspan="6" style="text-align: center; font-style: italic;">None avaliable</td>
                                </tr>
                            `;
                        }
                        approvalsHtml += `
                                </tbody>
                            </table>
                            <div class="entry-details-buttons">
                                <button id="draftButton" onclick="showDraft173Form('${data.pk}')">Create draft</button>
                            </div>
                            <hr>
                            <h3>Signature</h3>
                            <table class="approvals-table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Document</th>
                                        <th>Date Sent</th>
                                        <th>Status</th>
                                        <th>Signed document</th>
                                    </tr>
                                </thead>
                                <tbody>
                        `;
                        if (data.signature.length > 0) {
                            data.signature.sort((a, b) => a.pk - b.pk);
                            data.signature.forEach((signature, index) => {
                                const signatureDate = new Date(signature.date);
                                const formattedSignatureDate = `${String(signatureDate.getDate()).padStart(2, '0')} ${['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'][signatureDate.getMonth()]} ${signatureDate.getFullYear()}`;

                                approvalsHtml += `
                                    <tr>
                                        <td>${index + 1}</td>
                                        <td>${signature.document ? `<a href="${signature.document}" target="_blank">Download</a>` : 'No document'}</td>
                                        <td>${formattedSignatureDate}</td>
                                        <td>Pending</td>
                                        <td>Pending</td>
                                    </tr>
                                `;
                            });
                        } else {
                            // Adjust colspan to match the number of columns in your table
                            approvalsHtml += `
                                <tr>
                                    <td colspan="5" style="text-align: center; font-style: italic;">None avaliable</td>
                                </tr>
                            `;
                        }
                        approvalsHtml += `
                                </tbody>
                            </table>
                            <div class="entry-details-buttons">
                                <button id="signButton" onclick="openDocuSignModal('${data.pk}')">Send document for signing</button>
                            </div>
                            <hr>
                            <h3>Lodgement</h3>
                            <table class="approvals-table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Documents</th>
                                        <th>Sent To</th>
                                        <th>Date Sent</th>
                                        <th>Dealing Number</th>
                                        <th>Updated Certificate of Title</th>
                                    </tr>
                                </thead>
                                <tbody>
                        `;
                        if (data.lodge.length > 0) {
                            data.lodge.sort((a, b) => a.pk - b.pk);
                            data.lodge.forEach((signature, index) => {
                                const signatureDate = new Date(signature.date);
                                const formattedSignatureDate = `${String(signatureDate.getDate()).padStart(2, '0')} ${['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'][signatureDate.getMonth()]} ${signatureDate.getFullYear()}`;

                                approvalsHtml += `
                                    <tr>
                                        <td>${index + 1}</td>
                                        <td><a href="#" onclick="openDocumentsLodgedModal('${signature.pk}')">View Documents</a></td>
                                        <td>${signature.to}</td>
                                        <td>${formattedSignatureDate}</td>
                                        <td>${signature.dealing_number ? signature.dealing_number: 'Pending'}</td>
                                        <td>${signature.updated_cert ? `<a href="${signature.updated_cert}" target="_blank">Download</a>` : 'Pending'}</td>
                                    </tr>
                                `;
                            });
                        } else {
                            // Adjust colspan to match the number of columns in your table
                            approvalsHtml += `
                                <tr>
                                    <td colspan="7" style="text-align: center; font-style: italic;">None avaliable</td>
                                </tr>
                            `;
                        }
                        approvalsHtml += `
                                </tbody>
                            </table>
                            <div class="entry-details-buttons">
                                <button onclick="openLodgeEmailModal('${data.rdm_num}')">Lodge documents</button>

                            </div>
                        `;

                        detailsContainer.innerHTML += approvalsHtml; // Append the history table to the details container

                    })
                    .catch(error => {
                        console.error('Error fetching entry details:', error);
                    });
            } else {
                // If the same entry's "View" button is clicked again, toggle visibility
                if (detailsContainer.style.display === 'none' || detailsContainer.style.display === '') {
                    detailsContainer.style.display = 'block';
                    detailsContainer.style.visibility = 'visible';
                } else {
                    detailsContainer.style.display = 'none';
                    detailsContainer.style.visibility = 'hidden';
                }
                lastEntryId = null; // Reset lastEntryId for next clicks
            }
        }



    </script>


    <script>
        function getCSRFToken() {
            let csrfToken = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, "csrftoken".length + 1) === ("csrftoken" + '=')) {
                        csrfToken = decodeURIComponent(cookie.substring("csrftoken".length + 1));
                        break;
                    }
                }
            }
            return csrfToken;
        }

        function showDraft173Form(entryId) {
            document.getElementById('entryId').value = entryId;
            // Set the subject land address in the draft form
            if (window.currentSubjectLandAddress) {
                document.getElementById('SubjectLand').value = window.currentSubjectLandAddress;
            }
            document.getElementById('draftFormModal').style.display = 'block';

            // Assuming you have an endpoint that returns parties as JSON
            fetch(`/toph_lawfirm/get-party/${entryId}/`) 
                .then(response => response.json())
                .then(parties => {
                    // Assuming you have 5 signers, adjust as necessary
                    const signerDropdowns = [1, 2, 3, 4, 5, 6, 7].map(i => document.getElementById(`draftOwner${i}`));
                    signerDropdowns.forEach(dropdown => {
                        populateDropdownWithParties(dropdown, parties);
                    });
                })
                .catch(error => console.error('Failed to load parties:', error));
        }

        function openEditModal(entryId) {
            const url = `/toph_lawfirm/entry/edit/${entryId}/`;

            // Fetch the entry's current data for editing
            fetch(url)
                .then(response => response.text())
                .then(html => {
                    // Assuming the response is HTML form
                    document.getElementById('editEntryForm').innerHTML = html;
                    document.getElementById('editEntryModal').style.display = 'block';
                    initializeAddressFinderWidgets();
                })
                .catch(error => console.error('Error loading the edit form:', error));
        }

        function initializeAddressFinderWidgets() {
            new AddressFinder.Widget(
                document.getElementById("id_subject_land_address_edit"),
                "{{ addressfinder_api_key }}", // Replace with your actual API key
                "AU", {
                    "address_params": {
                        "gnaf": "1",
                        "state": "VIC"
                    }
                }
            );

            new AddressFinder.Widget(
                document.getElementById("id_contact_address_edit"),
                "{{ addressfinder_api_key }}", // Replace with your actual API key
                "AU", {
                    "address_params": {
                        "gnaf": "1",
                        "state": "VIC"
                    }
                }
            );
        }

        // Close modal on clicking the close button
        document.querySelector('.close').onclick = function () {
            document.getElementById('editEntryModal').style.display = 'none';
        };

        document.getElementById('editEntryForm').onsubmit = function (event) {
            event.preventDefault(); // Prevent default form submission

            const formData = new FormData(this);
            const url = this.action; // URL to submit the form data to

            fetch(url, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': getCSRFToken(), // Function to get CSRF token
                },
            })
                .then(response => {
                    if (response.ok) {
                        // Handle successful update here, e.g., close modal, refresh entry list
                        document.getElementById('editEntryModal').style.display = 'none';
                        // Optionally, refresh the entries list or update the UI as needed
                    } else {
                        throw new Error('Error updating the entry');
                    }
                })
                .catch(error => console.error('Error submitting the edit form:', error));
        };


    </script>

    <script type="text/javascript">
        // Define a global variable to store the current user's username
        const currentUserUsername = "{{ request.user.username }}";
    </script>

    <script>

        // Open modal
        function openAddEntryModal(lawFirm) {
            document.getElementById('hiddenLawFirm').value = lawFirm;
            document.getElementById('hiddenCouncil').value = "Cardinia Shire Council";
            document.getElementById('addEntryModal').style.display = "block";
            initializeAddressFinderAddEntryModal();
        }

        // Close the modal on clicking the close button
        document.querySelector('#addEntryModal .close').onclick = function () {
            document.getElementById('addEntryModal').style.display = 'none';
        };


        document.getElementById('addEntryForm').onsubmit = function (event) {
            event.preventDefault();
            document.getElementById("entry-submit-button").disabled = true;
            document.getElementById("entry-submit-button").textContent = 'Submitting...';

            const formData = new FormData(this);

            fetch(`/toph_lawfirm/add-entry/`, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': getCSRFToken(),
                },
            })
            .then(response => {
                if (response.ok) {
                } else {
                    throw new Error('Error updating the entry');
                }
            })
            .then(data => {
                document.getElementById('addEntryModal').style.display = 'none';
                //location.reload();
                refreshMattersTable();
            })
            .catch(error => console.error('Error submitting the edit form:', error))
            .finally(() => {
                // Re-enable the submit button after the operation is complete
                document.getElementById("entry-submit-button").disabled = false;
                document.getElementById("entry-submit-button").textContent = 'Submit'; // Reset button text or icon
            });
        };



    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Function to fetch and display the edit form
            function fetchEditForm(entryId) {
                const url = `/toph_lawfirm/entry/edit/${entryId}/`;
                fetch(url)
                    .then(response => response.text())
                    .then(html => {
                        document.querySelector('#editEntryForm').innerHTML = html;
                        document.querySelector('#editEntryModal').style.display = 'block';
                        attachFormSubmitHandler(entryId);
                        initializeAddressFinderWidgets();
                    })
                    .catch(error => console.error('Error loading edit form:', error));
            }

            // Attach this function to your edit button's onclick event
            window.fetchEditForm = fetchEditForm;

            // Function to handle form submission
            function attachFormSubmitHandler(entryId) {
                const form = document.querySelector('#editEntryForm');
                form.onsubmit = function (event) {
                    event.preventDefault();

                    document.getElementById("edit-submit-button").disabled = true;
                    document.getElementById("edit-submit-button").textContent = 'Submitting...';
                    const formData = new FormData(form);
                    const url = `/toph_lawfirm/entry/edit/${entryId}/`;
                    const csrfToken = form.querySelector('[name=csrfmiddlewaretoken]').value;
                    fetch(url, {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'X-CSRFToken': csrfToken,
                        },
                    })
                        .then(response => {
                            if (response.ok) {
                                document.querySelector('#editEntryModal').style.display = 'none';
                                tempEntryId = lastEntryId
                                viewEntry(tempEntryId);
                                viewEntry(tempEntryId);
                                refreshMattersTable();
                            } else {
                                console.error('Failed to update the entry');
                            }
                        })
                        .catch(error => console.error('Error submitting the edit form:', error))
                        .finally(() => {
                            // Re-enable the submit button after the operation is complete
                            document.getElementById("edit-submit-button").disabled = false;
                            document.getElementById("edit-submit-button").textContent = 'Submit'; // Reset button text or icon
                        });
                };
            }
        });

        // Close the modal on clicking the close button
        document.querySelector('#editEntryModal .close').onclick = function () {
            document.getElementById('editEntryModal').style.display = 'none';
        };

    </script>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>

    <script>
        function confirmDelete(entryId) {
            if (confirm("Are you sure you want to delete this entry?")) {
                // Redirect to the delete URL. Adjust this URL to match your application's routing.
                window.location.href = `/toph_lawfirm/delete-entry/${entryId}/`;
            }
        }

        function confirmDeleteApproval(approvalId) {
            if (confirm("Are you sure you want to delete this entry?")) {
                // Redirect to the delete URL. Adjust this URL to match your application's routing.
                fetch(`/toph_lawfirm/delete-approval/${approvalId}/`, { // Update with the correct path
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': getCSRFToken(), // Ensure you have a CSRF token function
                    },
                })
                    .then(response => response.json())
                    .then(data => {
                        tempEntryId = lastEntryId
                        viewEntry(tempEntryId);
                        viewEntry(tempEntryId);
                    })
                    .catch(error => console.error('Error:', error));
            }
        }

        // Function to show the draft agreement form and hide the overview content
        function showDraftForm() {
            var overviewContent = document.getElementById("overviewContent");
            var draftForm = document.getElementById("draftAgreementForm");
            overviewContent.style.display = "none";  // Hide the overview content
            draftForm.style.display = "block";  // Show the draft form
            // Update active state
            updateActiveState("draftLink");
        }

        // Function to show the overview content and hide the draft agreement form
        function showOverview() {
            var overviewContent = document.getElementById("overviewContent");
            var draftForm = document.getElementById("draftAgreementForm");
            overviewContent.style.display = "block";  // Show the overview content
            draftForm.style.display = "none";  // Hide the draft form
            // Update active state
            updateActiveState("overviewLink");
        }

        // Function to update the active state of sidebar links
        function updateActiveState(activeLinkId) {
            var sidebarLinks = document.querySelectorAll(".sidebar a");
            sidebarLinks.forEach(link => {
                if (link.id === activeLinkId) {
                    link.classList.add("active");
                } else {
                    link.classList.remove("active");
                }
            });
        }

        // Attach event listeners to sidebar links
        document.getElementById("overviewLink").addEventListener("click", showOverview);

        // Call showOverview initially to set the initial state
        showOverview();
    </script>

    <script>
        $(document).ready(function () {
            if ($.fn.dataTable.isDataTable('#entriesTable')) {
                // If the table instance exists, destroy it
                $('#entriesTable').DataTable().destroy();
            }

            // Now, initialize the DataTable
            var pendingTable = $('#entriesTable').DataTable({
                // DataTables initialization options
            });

            $('#groupSelect').on('change', function () {
                var selectedGroup = $(this).val();
                table.columns(1).search(selectedGroup).draw(); // Assuming the council/group info is in the 2nd column
            });
        });
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Close the modal on clicking the close button
            document.querySelector('#draftFormModal .close').onclick = function () {
                document.getElementById('draftFormModal').style.display = 'none';
            };



            // Handle form submission
            // Handle form submission
            const draftForm = document.getElementById('draft173Form');
            if (draftForm) {
                draftForm.addEventListener('submit', function (e) {
                    e.preventDefault(); // Prevent the default form submission

                    document.getElementById("draft-submit-button").disabled = true;
                    document.getElementById("draft-submit-button").textContent = 'Submitting...';

                    const formData = new FormData(this);
                    const selectedEntryMethod = draftForm.querySelector('input[name="entryMethod"]:checked').value;
                    formData.append('EntryMethod', selectedEntryMethod);

                    fetch('/toph_lawfirm/draft173/', { // Use the correct URL for your draft form endpoint
                        method: 'POST',
                        body: formData,
                        headers: {
                            'X-CSRFToken': formData.get('csrfmiddlewaretoken'), // Include CSRF Token
                        },
                    })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json(); // Parse JSON response
                        })
                        .then(data => {
                            if (data.success) {
                                document.getElementById("draftFormModal").style.display = "none"; // Close the modal
                                tempEntryId = lastEntryId
                                viewEntry(tempEntryId);
                                viewEntry(tempEntryId);
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            // Optionally, display an error message to the user
                        })
                        .finally(() => {
                            // Re-enable the submit button after the operation is complete
                            document.getElementById("draft-submit-button").disabled = false;
                            document.getElementById("draft-submit-button").textContent = 'Submit'; // Reset button text or icon
                        });
                });
            }

        });

    </script>

    <script>
        function openDocuSignModal(entryId) {
            document.getElementById('docusignEntryId').value = entryId;
            document.getElementById('docuSignModal').style.display = 'block';

            // Assuming you have an endpoint that returns parties as JSON
            fetch(`/toph_lawfirm/get-party/${entryId}/`) 
                .then(response => response.json())
                .then(parties => {
                    // Assuming you have 5 signers, adjust as necessary
                    const signerDropdowns = [1, 2, 3, 4, 5].map(i => document.getElementById(`OwnerName${i}`));
                    signerDropdowns.forEach(dropdown => {
                        populateDropdownWithParties(dropdown, parties);
                    });
                })
                .catch(error => console.error('Failed to load parties:', error));
        }

        function populateDropdownWithParties(dropdown, parties) {
            // Clear existing options first
            dropdown.innerHTML = '';
            // Add a default option
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'Select Party';
            dropdown.appendChild(defaultOption);
            // Populate the dropdown with parties
            parties.forEach(party => {
                const option = document.createElement('option');
                option.value = party.pk; // or party.name, depending on what you need
                option.textContent = party.name + ' - ' + party.role + ' - ' + party.email;
                dropdown.appendChild(option);
            });
        }


        function openApprovalModal(approval_id, entry_id) {
            document.getElementById('approval_approval_id').value = approval_id;
            document.getElementById('approval_entry_id').value = entry_id;
            document.getElementById('approval_cc_email').value = currentUserUsername;
            const modal = document.getElementById('approvalModal');

            const url = `/toph_lawfirm/get-review/${approval_id}`;
            
            let reviewedPartyIds = new Set(); // To store the IDs of parties who have reviewed

            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    const reviewDetails = document.getElementById('reviewDetails');
                    let tableHtml = `
                        <table class="approvals-table">
                            <thead>
                                <tr>
                                    <th>Reviewer</th>
                                    <th>Date sent</th>
                                    <th>Status</th>
                                    <th>Date reviewed</th>
                                    <th>Comment</th>
                                    <th>Document</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;

                    if (data && data.length > 0) {
                        data.forEach(review => {
                            const reviewDateSent = new Date(review.date_sent).toLocaleDateString('en-GB', {
                                day: 'numeric', month: 'short', year: 'numeric'
                            }).replace(/ /g, ' ');

                            const reviewDateReviewed = new Date(review.date_reviewed).toLocaleDateString('en-GB', {
                                day: 'numeric', month: 'short', year: 'numeric'
                            }).replace(/ /g, ' ');

                            tableHtml += `
                                <tr>
                                    <td>${review.party_name} (${review.party_role})</td>
                                    <td>${reviewDateSent}</td>
                                    <td>${review.status || 'Pending'}</td>
                                    <td>${review.status ? reviewDateReviewed : 'Pending'}</td>
                                    <td>${review.comment || 'Pending'}</td>
                                    <td>${review.document ? `<a href="${review.document}" target="_blank">Download</a>` : 'Pending'}</td>
                                </tr>
                            `;
                            // Add party ID to the set of reviewed parties
                            reviewedPartyIds.add(review.party_pk);
                        });
                    } else {
                        tableHtml += '<tr><td colspan="6" style="text-align: center;">No reviews found.</td></tr>';
                    }

                    tableHtml += `
                            </tbody>
                        </table>
                    `;

                    reviewDetails.innerHTML = tableHtml;
                })
                .then(() => {
                    const reviewersDropdown = document.getElementById('reviewersDropdown');
                    reviewersDropdown.innerHTML = ''; // Clear existing options

                    // Fetch parties for the entry and disable already reviewed parties in dropdown
                    fetch(`/toph_lawfirm/get-party/${entry_id}/`)
                        .then(response => response.json())
                        .then(parties => {

                            parties.forEach(party => {
                                const option = document.createElement('option');
                                option.value = party.pk;
                                option.textContent = `${party.name} - ${party.role} - ${party.email}`;
                                // Disable the option if this party ID is in the set of reviewedPartyIds
                                if (reviewedPartyIds.has(party.pk)) {
                                    option.disabled = true;
                                }
                                reviewersDropdown.appendChild(option);
                            });
                        })
                        .catch(error => console.error('Error:', error));
                })
                .catch(error => {
                    console.error('Error fetching review details:', error);
                });

            modal.style.display = 'block';
        }

        document.querySelector('#documentsLodgedModal .close').onclick = function () {
            document.getElementById('documentsLodgedModal').style.display = 'none';
        };

        function openDocumentsLodgedModal(lodge_id) {
            const modalmodal = document.getElementById('documentsLodgedModal');
            fetch(`/toph_lawfirm/get-documents-lodged/${lodge_id}/`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    const reviewDetails = document.getElementById('documentLodgedDetails');
                    let tableHtml = `
                        <table class="approvals-table">
                            <thead>
                                <tr>
                                    <th>Document</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;

                    if (data && data.length > 0) {
                        data.forEach(document => {
                            tableHtml += `
                                <tr>
                                    <td>${`<a href="${document.url}" target="_blank">${document.name}</a>`}</td>
                                </tr>
                            `;
                        });
                    } else {
                        tableHtml += '<tr><td colspan="1" style="text-align: center;">No documents found.</td></tr>';
                    }

                    tableHtml += `
                            </tbody>
                        </table>
                    `;

                    reviewDetails.innerHTML = tableHtml;
                })
                .catch(error => {
                    console.error('Error fetching document details:', error);
                });

            modalmodal.style.display = 'block';
        }


        function openShareModal(entry_id) {
            document.getElementById('share_entry_id').value = entry_id;
            const modal = document.getElementById('shareModal');

            const partyDropdown = document.getElementById('partyDropdown');
            partyDropdown.innerHTML = ''; // Clear existing options

            // Fetch parties for the entry and disable already reviewed parties in dropdown
            fetch(`/toph_lawfirm/get-party/${entry_id}/`)
                .then(response => response.json())
                .then(parties => {

                    parties.forEach(party => {
                        if (party.role !== 'Council') {
                            const option = document.createElement('option');
                            option.value = party.pk;
                            option.textContent = `${party.name} - ${party.role} - ${party.email}`;
                            partyDropdown.appendChild(option);
                        }
                    });
                })
                .catch(error => console.error('Error:', error));


            modal.style.display = 'block';
        }

        document.querySelector('#shareModal .close').onclick = function () {
            document.getElementById('shareModal').style.display = 'none';
        };


        document.getElementById('shareForm').onsubmit = function (event) {
            event.preventDefault();
            document.getElementById("share-submit-button").disabled = true;
            document.getElementById("share-submit-button").textContent = 'Submitting...';

            // Collect data from the form
            const formData = new FormData(this);

            // Send data to server to send the email
            fetch(`/toph_lawfirm/share-tracking/`, { // Adjust the URL
                method: 'POST',
                body: formData,
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Error');
                } else {
                    document.getElementById('shareModal').style.display = 'none';
                    tempEntryId = lastEntryId
                    viewEntry(tempEntryId);
                    viewEntry(tempEntryId);  
                }
            })
            .catch(error => console.error('Error:', error))        
            .finally(() => {
                // Re-enable the submit button after the operation is complete
                document.getElementById("share-submit-button").disabled = false;
                document.getElementById("share-submit-button").textContent = 'Submit'; // Reset button text or icon
            });
        };


        function openOutcomeModal(approval_id) {
            document.getElementById('outcome_approval_id').value = approval_id;
            const modal = document.getElementById('outcomeModal');
            modal.style.display = 'block';
        }

        document.querySelector('#outcomeModal .close').onclick = function () {
            document.getElementById('outcomeModal').style.display = 'none';
        };

        document.getElementById('outcomeForm').onsubmit = function (event) {
            event.preventDefault();
            document.getElementById("outcome-submit-button").disabled = true;
            document.getElementById("outcome-submit-button").textContent = 'Submitting...';

            // Collect data from the form
            const formData = new FormData(this);

            // Send data to server to send the email
            fetch(`/toph_lawfirm/set-approval-outcome/`, { // Adjust the URL
                method: 'POST',
                body: formData,
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Error');
                } else {
                    document.getElementById('outcomeModal').style.display = 'none';
                    tempEntryId = lastEntryId
                    viewEntry(tempEntryId);
                    viewEntry(tempEntryId);  
                }
            })
            .catch(error => console.error('Error:', error))        
            .finally(() => {
                // Re-enable the submit button after the operation is complete
                document.getElementById("outcome-submit-button").disabled = false;
                document.getElementById("outcome-submit-button").textContent = 'Submit'; // Reset button text or icon
            });
        };


        // Close the modal on clicking the close button
        document.querySelector('#docuSignModal .close').onclick = function () {
            document.getElementById('docuSignModal').style.display = 'none';
        };


        // Handle form submission
        document.getElementById('docuSignForm').onsubmit = function (event) {
            event.preventDefault(); // Prevent default form submission

            document.getElementById("docusign-submit-button").disabled = true;
            document.getElementById("docusign-submit-button").textContent = 'Submitting...';

            var formData = new FormData(this);
            var jsonData = {
                OwnerName1: document.getElementById('OwnerName1').value,
                OwnerName2: document.getElementById('OwnerName2').value,
                OwnerName3: document.getElementById('OwnerName3').value,
                OwnerName4: document.getElementById('OwnerName4').value,
                OwnerName5: document.getElementById('OwnerName5').value,
                OwnerOrder1: document.getElementById('OwnerOrder1').value,
                OwnerOrder2: document.getElementById('OwnerOrder2').value,
                OwnerOrder3: document.getElementById('OwnerOrder3').value,
                OwnerOrder4: document.getElementById('OwnerOrder4').value,
                OwnerOrder5: document.getElementById('OwnerOrder5').value,
                documentUrl: document.getElementById('documentUrl').value,
                reminderDelay: document.getElementById('reminderDelay').value,
                reminderFrequency: document.getElementById('reminderFrequency').value,
                entryId: document.getElementById('docusignEntryId').value,

            };
            formData.append('json_data', JSON.stringify(jsonData));

            // Make an AJAX request to your backend with the signer details and document URL
            fetch('/toph_lawfirm/docusign/', { // Adjust the URL
                method: 'POST',
                body: formData, // Send the form data
                credentials: 'include', // Include cookies
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('docuSignModal').style.display = 'none'; // Close the modal
                tempEntryId = lastEntryId
                viewEntry(tempEntryId);
                viewEntry(tempEntryId);
            })
            .catch(error => console.error('Error:', error))
            .finally(() => {
                // Re-enable the submit button after the operation is complete
                document.getElementById("docusign-submit-button").disabled = false;
                document.getElementById("docusign-submit-button").textContent = 'Submit'; // Reset button text or icon
            });
        };


    </script>


    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const numberOfOwnersDropdown = document.getElementById('numberOfOwners');
            const ownerSections = document.querySelectorAll('.owner-section');

            numberOfOwnersDropdown.addEventListener('change', function () {
                const selectedNumberOfOwners = parseInt(this.value);

                ownerSections.forEach((section, index) => {
                    if (index < selectedNumberOfOwners) {
                        section.style.display = ''; // Show the section
                    } else {
                        section.style.display = 'none'; // Hide the section
                    }
                });
            });
        });

    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const lodgeEmailModal = document.getElementById('lodgeEmailModal');
            const lodgeEmailForm = document.getElementById('lodgeEmailForm');
            const closeLodgeEmailModalButton = lodgeEmailModal.querySelector('.close');
            

            // Function to open the lodge email modal and set the entryId
            window.openLodgeEmailModal = function (entryId) {
                document.getElementById('lodgeEmailModal').style.display = 'block';
                document.getElementById('lodgeEntryId').value = entryId; 
                document.getElementById('ccEmail').value = currentUserUsername;
            };


            // Close the modal when the user clicks on <span> (x)
            closeLodgeEmailModalButton.onclick = function () {
                lodgeEmailModal.style.display = 'none';
            };

            // Prevent form from submitting the traditional way
            lodgeEmailForm.onsubmit = function (event) {
                event.preventDefault();
                document.getElementById("lodge-submit-button").disabled = true;
                document.getElementById("lodge-submit-button").textContent = 'Submitting...';

                // Collect data from the form
                const formData = new FormData(this);

                // Send data to server to send the email
                fetch('/toph_lawfirm/lodge/', { // Adjust the URL
                    method: 'POST',
                    body: formData
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to send email');
                    } else {
                        lodgeEmailModal.style.display = 'none';
                        tempEntryId = lastEntryId
                        viewEntry(tempEntryId);
                        viewEntry(tempEntryId);  
                    }
                })
                .catch(error => {
                    console.error('Error sending email:', error);
                    alert('Error sending email. Please try again.');
                })        
                .finally(() => {
                    // Re-enable the submit button after the operation is complete
                    document.getElementById("lodge-submit-button").disabled = false;
                    document.getElementById("lodge-submit-button").textContent = 'Submit'; // Reset button text or icon
                });
            };
        });


    </script>

    <script>

        // Show the context menu with the option to view reviews
        function showContextMenu(event, approvalId) {
            // Prevent default behavior (e.g., opening a context menu)
            event.preventDefault();

            // Hide any currently visible context menus
            const existingMenus = document.querySelectorAll('.context-menu');
            existingMenus.forEach(menu => {
                menu.style.display = 'none';
            });

            let contextMenu = document.getElementById(`contextMenu${approvalId}`);
            if (!contextMenu) {
                contextMenu = document.createElement('div');
                contextMenu.id = `contextMenu${approvalId}`;
                contextMenu.className = 'context-menu';
                contextMenu.innerHTML = `
                    <ul>
                        <li onclick="openReviewModal('${approvalId}')">View Reviews</li>
                        <li onclick="confirmDeleteApproval('${approvalId}')">Delete Approval</li>
                    </ul>`
                document.body.appendChild(contextMenu);
            }

            contextMenu.style.display = 'block';
            contextMenu.style.left = `${event.pageX}px`;
            contextMenu.style.top = `${event.pageY}px`;

            // Listen for click events on the document
            const closeContextMenu = (e) => {
                if (!contextMenu.contains(e.target)) {
                    contextMenu.style.display = 'none';
                    document.removeEventListener('click', closeContextMenu);
                }
            };

            // Delay adding the listener to avoid catching the current click
            setTimeout(() => document.addEventListener('click', closeContextMenu), 0);
        }

        document.addEventListener('click', function (event) {
            // Check if the clicked element is the context menu trigger or inside it
            if (event.target.matches('.context-menu-trigger') || event.target.closest('.context-menu-trigger')) {
                const approvalId = event.target.closest('.context-menu-trigger').getAttribute('data-approval-id');
                showContextMenu(event, approvalId);
            }
        });




        // Assuming the context menu is triggered like so:
        // Replace your existing click listener with one that opens the context menu
        document.body.addEventListener('click', function (event) {
            // Check if the clicked element is the context menu trigger or inside it
            if (event.target.matches('.context-menu-trigger') || event.target.closest('.context-menu-trigger')) {
                event.preventDefault();

                // Retrieve the approval ID. Use closest to find the nearest ancestor which is the trigger.
                const trigger = event.target.closest('.context-menu-trigger');
                const approvalId = trigger.getAttribute('data-approval-id');

                // Assuming showContextMenu is your exis    ting function to display the context menu
                showContextMenu(event, approvalId);
            }
        });

        document.addEventListener('click', function (event) {
            // Check if the clicked element is the "View Reviews" option
            if (event.target.classList.contains('delete-approval-option')) {
                // Prevent the default action
                event.preventDefault();

                // Extract the approvalId stored in a data attribute
                const approvalId = event.target.getAttribute('data-approval-id');

                // Call your function to toggle the reviews visibility
                confirmDeleteApproval(approvalId);
                hideAllContextMenus();
            } else if (event.target.classList.contains('approve-approval-option')) {
                // Prevent the default action
                event.preventDefault();
                const approval_id = event.target.getAttribute('data-approval-id');
                const entry_id = event.target.getAttribute('data-entry-id');
                // Call your function to toggle the reviews visibility
                openApprovalModal(approval_id, entry_id)
                hideAllContextMenus();
            } else if (event.target.classList.contains('outcome-approval-option')) {
                // Prevent the default action
                event.preventDefault();
                const approval_id = event.target.getAttribute('data-approval-id');
                // Call your function to toggle the reviews visibility
                openOutcomeModal(approval_id);
                hideAllContextMenus();
            }
        });


    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelector('#approvalModal .close').onclick = function () {
                document.getElementById('approvalModal').style.display = 'none';
            };
        });




        document.getElementById('approvalForm').addEventListener('submit', function (event) {
            event.preventDefault();

            if (reviewersDropdown.value === '') {
                alert('Please select a reviewer');
                return; // Stop the form submission
            }

            document.getElementById("approval-submit-button").disabled = true;
            document.getElementById("approval-submit-button").textContent = 'Submitting...';

            const formData = new FormData(this);
            const approval_id = document.getElementById('approval_approval_id').value;
            const entry_id = document.getElementById('approval_entry_id').value;
            

            fetch('/toph_lawfirm/upload-review/', { // Update with the correct path
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': getCSRFToken(), // Ensure you have a CSRF token function
                },
            })
                .then(response => response.json())
                .then(data => {
                    openApprovalModal(approval_id, entry_id)
                    // Handle success response
                })
                .catch(error => console.error('Error:', error))
                .finally(() => {
                    // Re-enable the submit button after the operation is complete
                    document.getElementById("approval-submit-button").disabled = false;
                    document.getElementById("approval-submit-button").textContent = 'Submit'; // Reset button text or icon
                });
        });

    </script>

    <script>
        function deleteApproval(approvalId) {
            if (confirm('Are you sure you want to delete this approval?')) {
                fetch(`/toph_lawfirm/delete-approval/${approvalId}/`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': getCSRFToken(), // Assume getCSRFToken() gets the CSRF token
                    },
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to delete the approval.');
                        }
                        return response.json(); // Or handle it depending on how your backend sends the response
                    })
                    .then(data => {
                        alert('Approval deleted successfully.');
                        // Optionally refresh the data or remove the row from the table
                    })
                    .catch(error => console.error('Error:', error));
            }
        }

    </script>

    
    <script>
        // Scripts for document modal

        function openAddDocumentModal(entryId) {
            document.getElementById('hiddenEntryId').value = entryId; // Set the hidden input value to the current entry ID
            const modal = document.getElementById('addDocumentModal');
            const documentsList = document.getElementById('documentsList');

            // Clear previous contents and set up a table with an additional "Delete" column
            documentsList.innerHTML = `<table class="approvals-table">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Download</th>
                                                <th>Delete</th>
                                            </tr>
                                        </thead>
                                        <tbody id="documentsTableBody">
                                        </tbody>
                                    </table>`;

            const tableBody = document.getElementById('documentsTableBody');

            // Fetching documents associated with the entry ID
            fetch(`/toph_lawfirm/get-document/${entryId}/`)
                .then(response => response.json())
                .then(documents => {
                    if (documents.length) {
                        documents.forEach(doc => {
                            console.log(doc);
                            // Create a row for each document
                            const row = document.createElement('tr');
                            row.innerHTML = `<td>${doc.name}</td>
                                            <td><a href="${doc.url}" download="${doc.name}">Download</a></td>
                                            <td><a href="#" onclick="deleteDocument('${doc.pk}', this, ${entryId})">Delete</a></td>`;
                            tableBody.appendChild(row);
                        });
                    } else {
                        tableBody.innerHTML = '<tr style="text-align: center; font-style: italic;"><td colspan="3">No documents available</td></tr>';
                    }
                })
                .catch(error => console.error('Error fetching documents:', error));

            modal.style.display = 'block';
        }

        // Close the modal on clicking the close button
        document.querySelector('#addDocumentModal .close').onclick = function () {
            document.getElementById('addDocumentModal').style.display = 'none';
        };

        // Clicking submit
        document.getElementById('addDocumentForm').onsubmit = function (event) {
            event.preventDefault();

            document.getElementById("document-submit-button").disabled = true;
            document.getElementById("document-submit-button").textContent = 'Submitting...';

            const formData = new FormData(this);
            const entryId = document.getElementById('hiddenEntryId').value;

            fetch(`/toph_lawfirm/upload-document/${entryId}/`, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': getCSRFToken(),
                },
            })
            .then(response => {
                if (response.ok) {
                } else {
                    throw new Error('Error updating the entry');
                }
            })
            .then(data => {
                openAddDocumentModal(entryId)
            })
            .catch(error => console.error('Error submitting the edit form:', error))
            .finally(() => {
                // Re-enable the submit button after the operation is complete
                document.getElementById("document-submit-button").disabled = false;
                document.getElementById("document-submit-button").textContent = 'Submit'; // Reset button text or icon
            });
        };

        // Clicking delete
        function deleteDocument(docId, element, entryId) {
            if(confirm("Are you sure you want to delete this document?")) {
                fetch(`/toph_lawfirm/delete-document/${docId}/`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': getCSRFToken(),
                    },
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to delete the document.');
                    }
                })
                .then(data => {
                    openAddDocumentModal(entryId)
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error deleting document. Please try again.');
                });
            }
        }

    </script>

    <script>
        // Scripts for party modal

        function openPartyModal(entryId) {
            document.getElementById('partyEntryId').value = entryId; // Set the hidden input value to the current entry ID
            const modal = document.getElementById('PartyModal');
            const partiesList = document.getElementById('partiesList');

            // Clear previous contents and set up a table with an additional "Delete" column
            partiesList.innerHTML = `<table class="approvals-table">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Name</th>
                                                <th>Role</th>
                                                <th>Email</th>
                                                <th>Phone</th>
                                                <th>Address</th>
                                                <th>Delete</th>
                                            </tr>
                                        </thead>
                                        <tbody id="partiesTableBody">
                                        </tbody>
                                    </table>`;

            const tableBody = document.getElementById('partiesTableBody');

            // Fetching documents associated with the entry ID
            fetch(`/toph_lawfirm/get-party/${entryId}/`)
                .then(response => response.json())
                .then(documents => {
                    if (documents.length) {
                        documents.forEach(doc => {
                            console.log(doc);
                            // Create a row for each document
                            const row = document.createElement('tr');
                            row.innerHTML = `   <td>${doc.pk}</td>
                                                <td>${doc.name}</td>
                                                <td>${doc.role}</td>
                                                <td>${doc.email || '-'}</td>
                                                <td>${doc.phone || '-'}</td>
                                                <td>${doc.address || '-'}</td>
                                                <td><a onclick="deleteParty('${doc.pk}', this, ${entryId})">Delete</a></td>`;
                            tableBody.appendChild(row);
                        });
                    } else {
                        tableBody.innerHTML = '<tr style="text-align: center; font-style: italic;"><td colspan="5">No parties available</td></tr>';
                    }
                })
                .catch(error => console.error('Error fetching parties:', error));

            modal.style.display = 'block';
        }

        // Close the modal on clicking the close button
        document.querySelector('#PartyModal .close').onclick = function () {
            document.getElementById('PartyModal').style.display = 'none';
        };

        // Clicking submit
        document.getElementById('PartyForm').onsubmit = function (event) {
            event.preventDefault();

            document.getElementById("party-submit-button").disabled = true;
            document.getElementById("party-submit-button").textContent = 'Submitting...';

            const formData = new FormData(this);
            const entryId = document.getElementById('partyEntryId').value;

            fetch(`/toph_lawfirm/upload-party/${entryId}/`, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': getCSRFToken(),
                },
            })
            .then(response => {
                if (response.ok) {
                } else {
                    throw new Error('Error updating the entry');
                }
            })
            .then(data => {
                openPartyModal(entryId)
            })
            .catch(error => console.error('Error submitting the edit form:', error))
            .finally(() => {
                // Re-enable the submit button after the operation is complete
                document.getElementById("party-submit-button").disabled = false;
                document.getElementById("party-submit-button").textContent = 'Submit'; // Reset button text or icon
            });
        };



        // Function to delete a document
        function deleteParty(docId, element, entryId) {
            if(confirm("Are you sure you want to delete this party?")) {
                fetch(`/toph_lawfirm/delete-party/${docId}/`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': getCSRFToken(), // Use your function to get CSRF token
                    },
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to delete the party.');
                    }
                })
                .then(data => {
                    openPartyModal(entryId)
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error deleting party. Please try again.');
                });
            }
        }


    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Toggle between Name/Address and ACN for Owner 1
            document.querySelectorAll('input[name="owner1InputType"]').forEach((input) => {
                input.addEventListener('change', function() {
                    if (this.value === 'nameAddress') {
                        document.getElementById('owner1NameAddress').style.display = '';
                        document.getElementById('owner1ACN').style.display = 'none';
                    } else if (this.value === 'acn') {
                        document.getElementById('owner1NameAddress').style.display = 'none';
                        document.getElementById('owner1ACN').style.display = '';
                    }
                });
            });

            document.querySelectorAll('input[name="owner2InputType"]').forEach((input) => {
                input.addEventListener('change', function() {
                    if (this.value === 'nameAddress') {
                        document.getElementById('owner2NameAddress').style.display = '';
                        document.getElementById('owner2ACN').style.display = 'none';
                    } else if (this.value === 'acn') {
                        document.getElementById('owner2NameAddress').style.display = 'none';
                        document.getElementById('owner2ACN').style.display = '';
                    }
                });
            });

            document.querySelectorAll('input[name="owner3InputType"]').forEach((input) => {
                input.addEventListener('change', function() {
                    if (this.value === 'nameAddress') {
                        document.getElementById('owner3NameAddress').style.display = '';
                        document.getElementById('owner3ACN').style.display = 'none';
                    } else if (this.value === 'acn') {
                        document.getElementById('owner3NameAddress').style.display = 'none';
                        document.getElementById('owner3ACN').style.display = '';
                    }
                });
            });

            document.querySelectorAll('input[name="owner4InputType"]').forEach((input) => {
                input.addEventListener('change', function() {
                    if (this.value === 'nameAddress') {
                        document.getElementById('owner4NameAddress').style.display = '';
                        document.getElementById('owner4ACN').style.display = 'none';
                    } else if (this.value === 'acn') {
                        document.getElementById('owner4NameAddress').style.display = 'none';
                        document.getElementById('owner4ACN').style.display = '';
                    }
                });
            });

            document.querySelectorAll('input[name="owner5InputType"]').forEach((input) => {
                input.addEventListener('change', function() {
                    if (this.value === 'nameAddress') {
                        document.getElementById('owner5NameAddress').style.display = '';
                        document.getElementById('owner5ACN').style.display = 'none';
                    } else if (this.value === 'acn') {
                        document.getElementById('owner5NameAddress').style.display = 'none';
                        document.getElementById('owner5ACN').style.display = '';
                    }
                });
            });
        });

    </script>

    <script>
        document.getElementById('emailAttachments').addEventListener('change', function(e) {
            var fileListContainer = document.getElementById('fileList');
            fileListContainer.innerHTML = ''; // Clear current file list

            // Loop through selected files and display their names
            Array.from(e.target.files).forEach((file, index) => {
                var fileElement = document.createElement('div');
                fileElement.textContent = `${index + 1}. ${file.name}`;
                fileListContainer.appendChild(fileElement);
            });
        });
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            
            var widget = new AddressFinder.Widget(
                document.getElementById("id_subject_land_address"),
                "{{ addressfinder_api_key }}",
                "AU", // Specify the country code. Change if you are targeting a different country.
                {
                    "address_params": {
                        "gnaf": "1",
                        "state": "VIC"
                    }
                }
            );
        
            var contactWidget = new AddressFinder.Widget(
                document.getElementById("id_contact_address"),
                "{{ addressfinder_api_key }}",
                "AU",
                {
                    "address_params": {
                        "gnaf": "1",
                        "state": "VIC"
                    }
                }
            );

            var contactWidgetParty = new AddressFinder.Widget(
                document.getElementById("id_address"),
                "{{ addressfinder_api_key }}",
                "AU",
                {
                    "address_params": {
                        "gnaf": "1",
                        "state": "VIC"
                    }
                }
            );

        
            // Callback function to handle address selection
            widget.on("result:select", function(fullAddress, metaData) {
                // Example: Populate the address field with the full address
                document.getElementById("id_subject_land_address").value = fullAddress.text;
            });
        
            contactWidget.on("result:select", function(fullAddress, metaData) {
                document.getElementById("id_contact_address").value = fullAddress.text;
            });

            contactWidgetParty.on("result:select", function(fullAddress, metaData) {
                document.getElementById("address").value = fullAddress.text;
            });

        });
    </script>

    <script>
        function initializeAddressFinderAddEntryModal() {
            var subjectLandAddressInput = document.getElementById("id_subject_land_address"); // Update ID as necessary
            var contactAddressInput = document.getElementById("id_contact_address"); // Update ID as necessary

            if (subjectLandAddressInput) {
                new AddressFinder.Widget(
                    subjectLandAddressInput,
                    "{{ addressfinder_api_key }}",
                    "AU", {
                        address_params: {
                            gnaf: "1",
                        "state": "VIC"
                        }
                    }
                );
            }

            if (contactAddressInput) {
                new AddressFinder.Widget(
                    contactAddressInput,
                    "{{ addressfinder_api_key }}",
                    "AU", {
                        address_params: {
                            gnaf: "1",
                        "state": "VIC"
                        }
                    }
                );
            }
        }
    </script>

    <script>
        // Function to refresh the Matters table content
        function refreshMattersTable() {
            fetch(`/toph_lawfirm/get-entry/`) // Make sure this URL correctly points to your JSON data endpoint
                .then(response => response.json())
                .then(data => {
                    // Assuming 'entriesTable' is the ID of your table
                    var table = $('#entriesTable').DataTable();
                    table.clear().draw(); // Clear the existing table data

                    data.forEach(entry => {
                        const createdDate = new Date(entry.fields.created_date);
                        const formattedDate = createdDate.toISOString().split('T')[0]; // Converts to YYYY-MM-DD format

                        // Check each field if it's empty, display "None" if true
                        const subjectLandAddress = entry.fields.subject_land_address || "None";
                        const contactName = entry.fields.contact_name || "None";
                        const council = entry.fields.council || "None";
                        const statusDisplay = entry.fields.status_display || "None"; // Assuming you have a 'status_display' field

                        // Add new row for each entry. Adjust the data fields according to your actual data structure
                        table.row.add([
                            entry.pk,
                            formattedDate,
                            subjectLandAddress,
                            statusDisplay,
                            `<a href="#" onclick="viewEntry('${entry.pk}'); return false;"><i class="fas fa-eye"></i></a>`
                        ]).draw(false); // false keeps the current paging position
                    });
                })
                .catch(error => console.error('Error refreshing matters table:', error));
        }

        function hideAllContextMenus() {
            const contextMenus = document.querySelectorAll('.context-menu');
            contextMenus.forEach(menu => menu.style.display = 'none');
        }


    </script>
        

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Function to show the "Council Information / Documents" section only
            function showCouncilInfo() {
                // Hide all section boxes
                var sectionBoxes = document.querySelectorAll('.section-box');
                sectionBoxes.forEach(function(box) {
                    box.style.display = 'none';
                });
        
                // Show only the "Council Information / Documents" section box
                var councilInfoBox = document.querySelector('.section-box:last-child'); // Assuming it's the last .section-box in .main-content
                councilInfoBox.style.display = 'block';
        
                // Update active state for sidebar links
                updateActiveState("councilLink");

                if(lastEntryId) {
                    viewEntry(lastEntryId);
                }
            }
        
            // Function to show the overview content except the "Council Information / Documents" section box
            function showOverviewExceptCouncilInfo() {
                // Show all section boxes
                var sectionBoxes = document.querySelectorAll('.section-box');
                sectionBoxes.forEach(function(box) {
                    box.style.display = 'block';
                });
        
                // Hide the "Council Information / Documents" section box
                var councilInfoBox = document.querySelector('.section-box:last-child'); // Assuming it's the last .section-box in .main-content
                councilInfoBox.style.display = 'none';
        
                // Update active state for sidebar links
                updateActiveState("overviewLink");
            }
        
            // Attach event listeners to sidebar links
            document.getElementById("councilLink").addEventListener("click", showCouncilInfo);
            document.getElementById("overviewLink").addEventListener("click", showOverviewExceptCouncilInfo);
        
            // Initial display setup
            showOverviewExceptCouncilInfo(); // Call this if you want the default view to exclude council info on page load
        });
    </script>

    <script>
        function openEditCouncilInfoModal(councilId) {
            document.getElementById('EditCouncilInfoModal').style.display = 'block';
        }
        
        // Close the modal on clicking the close button
        document.querySelector('#EditCouncilInfoModal .close').onclick = function () {
            document.getElementById('EditCouncilInfoModal').style.display = 'none';
        };

        document.getElementById('editCouncilInfoForm').addEventListener('submit', function(event) {
            event.preventDefault();

            document.getElementById("edit-council-submit-button").disabled = true;
            document.getElementById("edit-council-submit-button").textContent = 'Submitting...';
            
            // Example of collecting form data
            const formData = new FormData(this);
            fetch(`/toph_lawfirm/edit-council-info/`, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': getCSRFToken(),
                },
            })
            .then(response => {
                if (response.ok) {
                } else {
                    throw new Error('Error updating the entry');
                }
            })
            .then(data => {
                document.getElementById('EditCouncilInfoModal').style.display = 'none';
                location.reload(); // Reload the page to reflect the changes
                updateActiveState("councilLink");
                updateActiveState("councilLink");
                updateActiveState("councilLink");


            })
            .catch(error => console.error('Error submitting the edit form:', error))
            .finally(() => {
                // Re-enable the submit button after the operation is complete
                document.getElementById("edit-council-submit-button").disabled = false;
                document.getElementById("edit-council-submit-button").textContent = 'Submit'; // Reset button text or icon
            });
            
        });
    </script>
    
    <script>
        // JavaScript to toggle between manual entry and file upload
        document.addEventListener('DOMContentLoaded', function() {
            const entryMethodRadios = document.querySelectorAll('input[name="entryMethod"]');
            const manualEntryFields = document.getElementById('manualEntryFields');
            const fileUploadFields = document.getElementById('fileUploadFields');
        
            entryMethodRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'manual') {
                        manualEntryFields.style.display = '';
                        fileUploadFields.style.display = 'none';
                    } else if (this.value === 'upload') {
                        manualEntryFields.style.display = 'none';
                        fileUploadFields.style.display = '';
                    }
                });
            });
        });
    </script>
            

</body>

</html>
